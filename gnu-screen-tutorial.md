title: GNU Screen Tutorial
slug: gnu-screen-tutorial
date: 2014-01-13 10:28
updated: 2014-12-12 15:37
tags: gnu screen, linux

### 概念

*   **会话**, screen 有自己的会话的概念, 当你运行 `screen` 命令后, 你就启动了一个 "会话". 下文中的"会话"都是指 screen 会话.
*   **窗口**, 每一个会话可以包含一至多个窗口, 在每一个窗口中, 你可以做单独的工作. 比如说在窗口1 中开着 vim 写作, 在窗口2 中运行 netstat 监控网络, 而第三个窗口保持 bash shell 不做其他的事

默认情况下, 当你运行 `screen` 之后, screen 将为你建立一个会话, 并且为你建立一个默认的窗口, 并且, 为你在这个窗口中运行 bash shell.

### 优点

使用 screen 的优点是很多的, 尤其是你需要 ssh 登录到远程主机进行工作的时候, screen 可以帮助你使你即使从远程主机退出了, 你的工作也能够继续, 这是其一, 另一点就是它可以帮你"节省终端" - 当你需要登录远程做多个工作的时候, 你不必开多个终端分别 ssh 登录远程, 然后分别做各自的工作. 这在 _多个窗口_ 这一节会分析.

### 运行 screen

只需要简单的执行 `screen` 命令: 

    $ screen

一般来说, 你会看到一屏关于 screen 程序的介绍和版权信息, 根据按空格或回车就能跳过. 此时, 你便处于 screen 的"会话中"了, 之所以要加引号是因为你还可以处于会话之外, 稍候会提到.

### 会话之中

当你处于会话之中的时候, 你需要一种特殊的指令格式来给 screen 会话下达指令, 这种特殊的格式就是每当你想下达指令时, 你要先按一下 "Command Key", "Command Key" 在 screen 中被默认设定为 ^A(Ctrl-A), 也就是说, 每一步操作你都要先按一下 ^A. 比如想新建一个窗口, 那么就需要按下 `Ctrl-a, c`.

处于会话中时, 你可以对 screen 会话下达的指令很多, 你可以通过 `Ctrl-A, ?` 来列出所有可以执行的指令.

#### 多个窗口

默认情况下, 当你开启一个 screen 会话后, 会话中是只有一个窗口的, 拥有多个窗口可以为我们带来极大的方便, 尤其是在用 ssh 登录到远程主机的时候. 比如说我们需要登录到远程主机同时开着 iostat 和 netstat 来实时监控远程主机的运行状态. 我们有如下两种方式:

*   如果不使用 screen, 我们就需要开两个终端, 运行两次 ssh 登录到远程, 然后一个终端运行 `iostat`, 另一个终端运行 `netstat`; 

    这种方式无疑要麻烦许多, 你要登录两次远程, 还浪费了你本地的终端...

*   如果我们使用 screen 但是不使用多窗口, 我们固然可以只开一个终端 ssh 到远程, 然后开一个 screen 会话, 运行 `iostat`, 然后 detach 这个会话(后面介绍), 再开一个 screen 会话, 运行 `netstat`. 

    这种方式比上面那种好不了多少, 甚至更差, 因为你没法同时检测磁盘运行和网络运行状况, 你要查看磁盘运行, 就要 detach 掉运行 `netstat` 的那个 screen 会话, retach 到运行 `iostat` 的那个会话, 反之亦然.

然而当你在一个会话中使用多窗口后, 一切都变得那么优雅, 而创建新的窗口又是那么的简单, 下面我们来看一下与窗口相关的几个指令: 

*   `Ctrl-A, c`, 创建一个新的窗口, 以这种方式创建的窗口会默认的运行 bash shell
*   `Ctrl-A, w`, 显示会话中的所有窗口, 会显示窗口的标号, 当前的窗口会以星号标识
*   `Ctrl-A, 0`/`Ctrl-A, 1`..., 切换到标号为 0/1 的窗口
*   `Ctrl-A, "`, 显示会话中的所有窗口, 并且可以通过方向键和回车键选择切换窗口
*   `Ctrl-A, p`/`Ctrl-A, n`, 切换到前一个/后一个窗口

如此一来, 我们就可以在一个窗口中运行 iostat, 然后 `Ctrl-A, c` 创建另一个窗口运行 `netstat`, 不过慢着, 以这种方式创建出来的新窗口, 其显示区域是会覆盖之前的窗口的, 这样一来, 岂不是也不能同时查看 `iostat` 和 `netstat` 的监控情况吗? 别急, screen 还有另一个功能.

#### 多显示区域

我觉得 screen 最方便的地方就是支持将会话分成多个显示区域, 并且每个显示区域都可以显示任意的一个窗口. 

我们可以在会话中创建两个窗口, 分别运行 iostat 和 netstat, 然后将会话分成左右两个显示区域, 每个区域显示一个窗口的内容, perfect right?

*   `Ctrl-A, S`, 水平分割会话中的显示区域
*   `Ctrl-A, |`, 垂直分割
*   `Ctrl-A, TAB`, 切换到下一个显示区域

分割出来的新的显示区域默认是什么都不运行也什么都不显示的, 我们可以在切换到新的显示区域后, 结合 `Ctrl-A, n`/`Ctrl-A, p`/`Ctrl-A, 0`/`Ctrl-A, "` 来让这个新的区域显示已有的窗口, 通过 `Ctrl-A, c` 等来在这个区域新建一个窗口(并运行 bash shell).

### 会话之外

#### 脱离(detach)会话

当我们按下 `Ctrl-A, d`, 我们就能够从会话中脱离, 这也就使我们回到了正常的 shell 环境中.

#### 列出存在的 screen 会话

命令 `$ screen -ls` 能够列出当前系统中存在的会话, 这会显示出会话的名字.

#### 依附到(retach)会话

命令 `$ screen -r [session_name]` 可以是我们依附到某个存在的会话中. 我们可以先使用 `screen -ls` 获得当前的会话列表, 然后依附到某个会话.

### 退出 screen

在会话中的 shell 提示符下输入 `exit` 命令就可以退出会话, 不过, 如果你开了多个窗口, 那么每执行一次 `exit`, 只是会退出一个窗口, 直到最后一个窗口退出, 会话才会退出.
