<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>LoxiGen 与 Indigo 项目介绍 -</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="LoxiGen Indigo"><meta property="og:title" content="LoxiGen 与 Indigo 项目介绍"><meta property="og:description" content="LoxiGen Indigo"><meta property="og:type" content="article"><meta property="og:url" content="https://cifer76.github.io/posts/indigo-loxigen/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-12-31T00:00:00+00:00"><meta property="article:modified_time" content="2016-12-31T00:00:00+00:00"><meta itemprop=name content="LoxiGen 与 Indigo 项目介绍"><meta itemprop=description content="LoxiGen Indigo"><meta itemprop=datePublished content="2016-12-31T00:00:00+00:00"><meta itemprop=dateModified content="2016-12-31T00:00:00+00:00"><meta itemprop=wordCount content="364"><meta itemprop=keywords content="Openflow,SDN,"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-48551763-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class="logo logo--mixed"><a class=logo__link href=/ title=狂想曲 rel=home><div class="logo__item logo__imagebox"><img class=logo__img src=/logo.png></div><div class="logo__item logo__text"><div class=logo__title>狂想曲</div><div class=logo__tagline>勇敢的灵魂追寻本我</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/investing><span class=menu__text>How to Invest</span></a></li><li class=menu__item><a class=menu__link href=/how-to-learn><span class=menu__text>How to learn new things</span></a></li><li class=menu__item><a class=menu__link href=/reading><span class=menu__text>Readings</span></a></li><li class=menu__item><a class=menu__link href=/eight-part-essay><span class=menu__text>SKILLS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>LoxiGen 与 Indigo 项目介绍</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2016-12-31T00:00:00Z>2016-12-31</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/sdn/ rel=category>SDN</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#关于-loxi-与-loxigen>关于 LOXI 与 Loxigen</a></li><li><a href=#indigo-项目源码构成>Indigo 项目源码构成</a></li><li><a href=#indigo-与-loxigen>Indigo 与 LoxiGen</a></li></ul></nav></div></div><div class="content post__content clearfix"><p>Indigo 是由 Big Switch 开发, 现在托管在 Floodlight 组织下的 OpenFlow agent 开源实现. OpenFlow 控制器的开源实现有很多, 像是 Ryu, ODL, POX 等等, 但是 agent 方面的开源实现可能相对少一些, Indigo 是一个非常精巧的实现, 但是似乎网上 SDN 相关的中文社区对其介绍的文档却很少, 本文将对 Indigo 及其所依附的 LoxiGen 项目做一个简单的介绍.</p><h2 id=关于-loxi-与-loxigen>关于 LOXI 与 Loxigen</h2><p>LOXI (Logical OpenFlow eXtensible Interface), 是一种描述 OpenFlow 协议的逻辑语言.</p><p>LoxiGen 项目能够解读 LOXI 语言, 进而用来生成各种编程语言的 OpenFlow 协议库. 所以说 LoxiGen 实际上是一个 “编译器” 项目, 可想而知 LoxiGen 包含一个前端用来解析 LOXI 语言, 以及包含各种编程语言的后端来生成这些编程语言的代码. 目前包含 Java, Python 以及 C 语言的后端, 生成的 C 版本的协议库叫做 LOCI, Java 版本的叫做 OpenFlowJ, Python 版本的叫做 pyloxi.</p><blockquote><p>LoxiGen is a tool that generate OpenFlow protocol library for a number of languages. It is composed of a frontend that parses wire protocol descriptions and a backend for each supported language (currently C, Python and Java, with an auto-generated wireshark dissector in Lua on the way).</p></blockquote><p>LoxiGen 项目组维护了一个快照, 定期的生成各种语言的协议库, 并将其放在 loxigen-artifacts 仓库下, 这样对于使用者来说只需要定期从 loxigen-artifacts 仓库拿现成的就行了, 连构建都不需要自己构建.</p><h2 id=indigo-项目源码构成>Indigo 项目源码构成</h2><p>Indigo 项目 (<a href=https://github.com/floodlight/indigo>https://github.com/floodlight/indigo</a>) 为我们提供了一些与平台无关的基础功能, 包括:</p><ul><li>IO 复用与定时器管理框架: 提供了通用的 socket 回调注册机制与定时器回调处理机制, 让我们能够在单一线程中同时处理多个 sockets 的读写以及定时器的回调事件.</li><li>OpenFlow 连接管理: 维护每一条与控制器之间的连接, 包括连接的建立, 心跳维持, 消息收发以及连接的终止.</li><li>OpenFlow 状态管理: 包括与控制器之间的各种消息的处理以及交换机状态的上报都会在这里处理</li><li>配置模块: 提供了平台无关的配置接口</li></ul><p>另外 Indigo 中有一些平台相关的功能是需要厂商自己来实现的, 这包括:</p><ul><li>Forwarding 模块: 负责实现将控制器下发的流表下发到交换机芯片中的接口</li><li>Port Manager 模块: 负责实现端口管理的接口</li></ul><p>芯片厂商需要负责实现后两个模块, 一般来讲就是将这两个模块中 indigo 所定义的接口用自己芯片的 sdk 来实现. 关于 Indigo 适配有一个很好的例子就是 Broadcom 的 OF-DPA, 我们可以从 Broadcom 的 <a href=https://github.com/Broadcom-Switch/of-dpa/>OF-DPA</a> 项目仓库中获得实现了 Forwarding 和 Port Manager 模块之后的 indigo 代码.</p><p>OF-DPA 项目托管在 <code>https://github.com/Broadcom-Switch/of-dpa/</code>, 其对 Indigo 项目做了些许代码上的改动, 从这个地址获得 OF-DPA 的代码, indigo 的代码位于 ofagent/ 目录下:</p><pre><code>ofagent/
    application/
    indigo/
    ofdpadriver/
</code></pre><p>其中 <code>indigo/</code> 目录中就是 indigo 的源码; <code>ofdpadriver/</code> 是 OF-DPA 实现好的 Forwarding 和 Port manager 模块的代码, 这两部分会调用芯片 sdk; <code>application/</code> 目录中只有一个源文件: <code>ofagent.c</code>, 这是一个示例程序, 向我们展示了如何初始化以及启动 indigo.</p><p>在 indigo 的项目代码也就是 <code>indigo/</code> 目录下, 又有两个子目录: <code>modules/</code> 和 <code>submodules/</code>, 其中 <code>modules/</code> 里面是 indigo 自身的代码, <code>submodules/</code> 里是 indigo 所用到的非自身的代码, 目前有 bigcode, infra, loxigen-artifacts.</p><p>bigcode 和 infra 都是 Floodlight 开发的通用工具库, 另外你可能注意到了 Indigo 使用了 loxigen-artifacts 中的代码. 下面就看一下 indigo 具体是如何使用 loxigen 的.</p><h2 id=indigo-与-loxigen>Indigo 与 LoxiGen</h2><p>Indigo 使用了 LoxiGen 项目生成的 LOCI 协议库, 并且是直接把源代码拿来使用的. 一开始将其放在 <code>indigo/modules/loci/</code> 目录下, Indigo 的维护者从 loxigen-artifacts 获得最新的代码, 然后再将其与 <code>modules/loci/</code> 下原本的 loxigen 项目代码合并或者直接替换. 因为这样每次都需要维护者手动去 pull loxigen-artifacts, 然后与 Indigo 的 codebase 合并, 后来估计是 Indigo 的维护者也觉得这样太笨了, 于是就干脆不往 <code>modules/loci/</code> 里面合了, 而是直接借助了 git submodule 机制, 把 loxigen-artifacts 用 git pull 拉下来放到了 <code>submodules/loxigen-artifacts/</code>, 然后 <code>modules/loci/make.mk</code> 做了如下的改动, 直接指向 <code>submodules/loxigen-artifacts/</code>.</p><pre><code>-loci_INCLUDES := -I $(dir $(lastword $(MAKEFILE_LIST)))inc
-loci_INTERNAL_INCLUDES := -I $(dir $(lastword $(MAKEFILE_LIST)))src
+LOCI := $(SUBMODULE_LOXIGEN_ARTIFACTS)/loci

+loci_INCLUDES := -I $(LOCI)/inc
+loci_INTERNAL_INCLUDES := -I $(LOCI)/src

+LIBRARY := loci
+loci_SUBDIR := $(LOCI)/src
+include $(BUILDER)/lib.mk
</code></pre><p>这样一来, 编译 indigo 项目时就会直接从 <code>submodules/loxigen-artifacts/</code> 处获取 loxigen 的源码.</p><p>(End)</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/openflow/ rel=tag>Openflow</a></li><li class=tags__item><a class="tags__link btn" href=/tags/sdn/ rel=tag>SDN</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><div class=authorbox__header><span class=authorbox__name>About Cifer</span></div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/posts/a-problem-ryu-indigo-conn-setup/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>记一次 Indigo 与 Ryu 的连接建立问题</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/posts/embedded-hashtable-implementation/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>嵌入式哈系表的实现</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//justforfree.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Cifer.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>