<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Indigo -</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel=alternate type=application/rss+xml href=/tags/indigo/index.xml title><link rel="shortcut icon" href=/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-48551763-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class="logo logo--mixed"><a class=logo__link href=/ title=狂想曲 rel=home><div class="logo__item logo__imagebox"><img class=logo__img src=/logo.png></div><div class="logo__item logo__text"><div class=logo__title>狂想曲</div><div class=logo__tagline>勇敢的灵魂追寻本我</div></div></a></div><div class=divider></div></div></header><div class="wrapper flex"><div class=primary><main class="main list" role=main><header class=main__header><h1 class=main__title>Indigo</h1></header><article class="list__item post"><header class=list__header><h2 class="list__title post__title"><a href=/posts/a-problem-ryu-indigo-conn-setup/ rel=bookmark>记一次 Indigo 与 Ryu 的连接建立问题</a></h2></header><div class="content list__excerpt post__content clearfix">之前在研究 Indigo 和 Ryu 的衔接时碰到一个 OpenFlow 连接建立失败的问题, 特此记录下, 希望能够供别人参考.
在了解这个问题之前, 我们先回顾一下 OpenFlow 连接建立过程.
OpenFlow 协议的连接建立过程 根据 OpenFlow 协议标准的陈述我们能够知道, 交换机和控制器之间使用 TCP (或者 SSL) 传输协议, 交换机必须能够主动发起连接 (实际应用中, 连接一般都是都由交换机主动发起), 另外就是所有的 OpenFlow 消息, 都要用网络序 (大端序) 发送 (参见 OpenFlow Spec v1.3 以及 v1.4 的第 7 章)
TCP 连接的建立我们很熟悉了, 就是典型的三此握手过程. 在 TCP 连接建立以后, 交换机和控制器双方在 TCP 连接建立后需要立即发送给 OF_HELLO 消息给对方, 并且 OF_HELLO 必须是双发发送给对方的第一个消息, OF_HELLO 消息同时起到协商 OpenFlow 版本的功能.
当双方都收到了对方的 OF_HELLO 消息并且两边都共同支持一个最小版本, OpenFlow 连接就成功建立了, 接下来控制器就可以向交换机发送其它的消息, 比如一般第一次要发送的就是 OFPT_FEATURES_REQUEST 消息.
遇到的问题 在这部分工作中基于 Ryu 框架我写了个简单的 Ryu 小程序令它与 Indigo 通信, 但是发现似乎连接建立都不成功, 好在 indigo 项目的错误日志部分做的很好, 我打开了 verbose 级别的日志, 发现连接建立过程中 indigo 在收取 OF_HELLO 这个消息失败了, 结合代码发现是在读 socket 时发生了 EAGAIN (Resource temporary unvailable) 错误.</div></article></main></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://duckduckgo.com/><label><input class=widget-search__field type=search placeholder=SEARCH… name=q aria-label=SEARCH…></label>
<input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sites value=https://cifer76.github.io></form></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/posts/year-in-review-2020/>2020 年终总结</a></li><li class=widget__item><a class=widget__link href=/posts/rust-singleton/>Rust 里的单例模式</a></li><li class=widget__item><a class=widget__link href=/posts/aws-redis-cluster/>AWS Implementation of Redis Cluster</a></li><li class=widget__item><a class=widget__link href=/posts/browser-tracking/>浏览器追踪技术与防范</a></li><li class=widget__item><a class=widget__link href=/posts/jit/>对解释器与 JIT 的一点思考</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/algorithm/>Algorithm</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/bitcoin/>Bitcoin</a>&nbsp;
<span class="widget__counter widget__counter--bubble">7</span></li><li class=widget__item><a class=widget__link href=/categories/blockchain/>Blockchain</a>&nbsp;
<span class="widget__counter widget__counter--bubble">4</span></li><li class=widget__item><a class=widget__link href=/categories/c/>C</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/freertos/>FreeRTOS</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/knowledge/>Knowledge</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/linux/>Linux</a>&nbsp;
<span class="widget__counter widget__counter--bubble">3</span></li><li class=widget__item><a class=widget__link href=/categories/nginx/>Nginx</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/php/>PHP</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/programming/>Programming</a>&nbsp;
<span class="widget__counter widget__counter--bubble">6</span></li><li class=widget__item><a class=widget__link href=/categories/python/>Python</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/reading/>Reading</a>&nbsp;
<span class="widget__counter widget__counter--bubble">3</span></li><li class=widget__item><a class=widget__link href=/categories/redis/>Redis</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/rust/>Rust</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/sdn/>SDN</a>&nbsp;
<span class="widget__counter widget__counter--bubble">2</span></li><li class=widget__item><a class=widget__link href=/categories/web/>Web</a>&nbsp;
<span class="widget__counter widget__counter--bubble">2</span></li><li class=widget__item><a class=widget__link href=/categories/yearinreview/>YearInReview</a>&nbsp;
<span class="widget__counter widget__counter--bubble">3</span></li><li class=widget__item><a class=widget__link href=/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/>嵌入式</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/%E8%81%8C%E4%B8%9A/>职业</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/algorithm/ title=algorithm>algorithm</a>
<a class="widget-taglist__link widget__link btn" href=/tags/async-io/ title="async io">async io</a>
<a class="widget-taglist__link widget__link btn" href=/tags/aws/ title=aws>aws</a>
<a class="widget-taglist__link widget__link btn" href=/tags/binary-tree/ title="binary tree">binary tree</a>
<a class="widget-taglist__link widget__link btn" href=/tags/bitcoin/ title=bitcoin>bitcoin</a>
<a class="widget-taglist__link widget__link btn" href=/tags/c/ title=C>C</a>
<a class="widget-taglist__link widget__link btn" href=/tags/c++/ title=C++>C++</a>
<a class="widget-taglist__link widget__link btn" href=/tags/c-programming/ title="C Programming">C Programming</a>
<a class="widget-taglist__link widget__link btn" href=/tags/cgi/ title=cgi>cgi</a>
<a class="widget-taglist__link widget__link btn" href=/tags/coroutine/ title=coroutine>coroutine</a>
<a class="widget-taglist__link widget__link btn" href=/tags/dfs/ title=DFS>DFS</a>
<a class="widget-taglist__link widget__link btn" href=/tags/dpos/ title=dpos>dpos</a>
<a class="widget-taglist__link widget__link btn" href=/tags/electrum/ title=Electrum>Electrum</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ethereum/ title=Ethereum>Ethereum</a>
<a class="widget-taglist__link widget__link btn" href=/tags/fastcgi/ title=fastcgi>fastcgi</a>
<a class="widget-taglist__link widget__link btn" href=/tags/hp-%E5%B0%8F%E5%9E%8B%E6%9C%BA/ title="HP 小型机">HP 小型机</a>
<a class="widget-taglist__link widget__link btn" href=/tags/indigo/ title=Indigo>Indigo</a>
<a class="widget-taglist__link widget__link btn" href=/tags/jit/ title=JIT>JIT</a>
<a class="widget-taglist__link widget__link btn" href=/tags/kernel/ title=kernel>kernel</a>
<a class="widget-taglist__link widget__link btn" href=/tags/leetcode/ title=leetcode>leetcode</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linux/ title=linux>linux</a>
<a class="widget-taglist__link widget__link btn" href=/tags/nginx/ title=nginx>nginx</a>
<a class="widget-taglist__link widget__link btn" href=/tags/openflow/ title=OpenFlow>OpenFlow</a>
<a class="widget-taglist__link widget__link btn" href=/tags/openjtag/ title=openjtag>openjtag</a>
<a class="widget-taglist__link widget__link btn" href=/tags/openocd/ title=openocd>openocd</a>
<a class="widget-taglist__link widget__link btn" href=/tags/pam/ title=pam>pam</a>
<a class="widget-taglist__link widget__link btn" href=/tags/pathinfo/ title=pathinfo>pathinfo</a>
<a class="widget-taglist__link widget__link btn" href=/tags/php/ title=php>php</a>
<a class="widget-taglist__link widget__link btn" href=/tags/privacy/ title=privacy>privacy</a>
<a class="widget-taglist__link widget__link btn" href=/tags/programming/ title=programming>programming</a>
<a class="widget-taglist__link widget__link btn" href=/tags/redis/ title=redis>redis</a>
<a class="widget-taglist__link widget__link btn" href=/tags/rhel/ title=rhel>rhel</a>
<a class="widget-taglist__link widget__link btn" href=/tags/rust/ title=rust>rust</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ryu/ title=Ryu>Ryu</a>
<a class="widget-taglist__link widget__link btn" href=/tags/sdn/ title=SDN>SDN</a>
<a class="widget-taglist__link widget__link btn" href=/tags/segwit/ title=segwit>segwit</a>
<a class="widget-taglist__link widget__link btn" href=/tags/solidity/ title=Solidity>Solidity</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/ title=嵌入式>嵌入式</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%BF%BB%E8%AF%91/ title=翻译>翻译</a></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">Social</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Twitter rel="noopener noreferrer" href=https://twitter.com/0x76i target=_blank><svg class="widget-social__link-icon icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5.0-78.8 35.3-78.8 78.8.0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3C20 26 16.1 39.6 16.1 54c0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1.0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4.0-12.6-.4-18.8-1.1C34.9 299 76.3 312 120.8 312c144.9.0 224.1-120 224.1-224.1.0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg><span>Twitter</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/cifer76 target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2C329 348.2 384 276.4 384 191.7 384 85.8 298 0 192 0z"/></svg><span>GitHub</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Email href=mailto:mantianyu@gmail.com><svg class="widget-social__link-icon icon icon-mail" width="24" height="24" viewBox="0 0 416 288"><path d="m0 16v256 16h16 384 16v-16V16 0h-16H16 0zm347 16-139 92.5L69 32zM199 157.5l9 5.5 9-5.5L384 46v210H32V46z"/></svg><span>mantianyu@gmail.com</span></a></div></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 .
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>